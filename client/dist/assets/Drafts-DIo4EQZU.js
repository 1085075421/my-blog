import{_ as M,o as O,a as l,c as g,b as $,d as n,w as o,e as b,f as s,g as P,t as w,h as j,E as i,i as C,r as u,j as r,k as A,l as z,u as U}from"./index-B2nFemfM.js";const L={class:"drafts"},R={class:"container"},q={class:"card-header"},F={key:1},G={key:0},H={key:1,style:{color:"#999"}},K={key:0,class:"pagination"},Q={__name:"Drafts",setup(W){const I=U(),_=u([]),m=u(!1),v=u(1),f=u(10),y=u(0),h=u(null),S=a=>a?new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",d=async()=>{const a=JSON.parse(localStorage.getItem("user")||"{}");if(!a.userId){i.warning("请先登录"),I.push("/login");return}m.value=!0;try{const e=await C.get(`/articles/drafts?userId=${a.userId}&page=${v.value-1}&size=${f.value}`);_.value=e.content||[],y.value=e.totalElements||0}catch(e){console.error("加载草稿失败:",e),i.error("加载草稿失败")}finally{m.value=!1}},B=async a=>{try{await z.confirm("确定要发布这篇草稿吗？发布后草稿将变为正式文章。","确认发布",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),h.value=a.id;const e=JSON.parse(localStorage.getItem("user")||"{}");await C.post(`/articles/drafts/${a.id}/publish?userId=${e.userId}`),i.success("发布成功"),await d()}catch(e){e!=="cancel"&&(console.error("发布失败:",e),i.error("发布失败"))}finally{h.value=null}},D=async a=>{try{await z.confirm("确定要删除这篇草稿吗？删除后无法恢复。","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=JSON.parse(localStorage.getItem("user")||"{}");await C.delete(`/articles/${a.id}?userId=${e.userId}`),i.success("删除成功"),await d()}catch(e){e!=="cancel"&&(console.error("删除失败:",e),i.error("删除失败"))}};return O(()=>{d()}),(a,e)=>{const c=r("el-button"),x=r("el-empty"),N=r("el-link"),p=r("el-table-column"),E=r("el-table"),T=r("el-pagination"),V=r("el-card"),J=A("loading");return l(),g("div",L,[$("div",R,[n(V,null,{header:o(()=>[$("div",q,[e[5]||(e[5]=$("h2",null,"草稿箱",-1)),n(c,{type:"primary",onClick:e[0]||(e[0]=t=>a.$router.push("/editor"))},{default:o(()=>[...e[4]||(e[4]=[s("新建文章",-1)])]),_:1})])]),default:o(()=>[!m.value&&_.value.length===0?(l(),b(x,{key:0,description:"暂无草稿"},{default:o(()=>[n(c,{type:"primary",onClick:e[1]||(e[1]=t=>a.$router.push("/editor"))},{default:o(()=>[...e[6]||(e[6]=[s("立即创建",-1)])]),_:1})]),_:1})):(l(),g("div",F,[P((l(),b(E,{data:_.value,style:{width:"100%"}},{default:o(()=>[n(p,{prop:"title",label:"标题","min-width":"200"},{default:o(({row:t})=>[n(N,{type:"primary",onClick:k=>a.$router.push(`/editor/${t.id}`),underline:!1},{default:o(()=>[s(w(t.title||"无标题"),1)]),_:2},1032,["onClick"])]),_:1}),n(p,{prop:"summary",label:"摘要","min-width":"250","show-overflow-tooltip":""}),n(p,{prop:"category",label:"分类",width:"120"},{default:o(({row:t})=>[t.category?(l(),g("span",G,w(t.category.name),1)):(l(),g("span",H,"未分类"))]),_:1}),n(p,{prop:"updatedAt",label:"更新时间",width:"180"},{default:o(({row:t})=>[s(w(S(t.updatedAt)),1)]),_:1}),n(p,{label:"操作",width:"200",fixed:"right"},{default:o(({row:t})=>[n(c,{type:"primary",size:"small",onClick:k=>a.$router.push(`/editor/${t.id}`)},{default:o(()=>[...e[7]||(e[7]=[s(" 编辑 ",-1)])]),_:1},8,["onClick"]),n(c,{type:"success",size:"small",onClick:k=>B(t),loading:h.value===t.id},{default:o(()=>[...e[8]||(e[8]=[s(" 发布 ",-1)])]),_:1},8,["onClick","loading"]),n(c,{type:"danger",size:"small",onClick:k=>D(t)},{default:o(()=>[...e[9]||(e[9]=[s(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[J,m.value]]),y.value>f.value?(l(),g("div",K,[n(T,{"current-page":v.value,"onUpdate:currentPage":e[2]||(e[2]=t=>v.value=t),"page-size":f.value,"onUpdate:pageSize":e[3]||(e[3]=t=>f.value=t),"page-sizes":[10,20,50],total:y.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:d,onCurrentChange:d},null,8,["current-page","page-size","total"])])):j("",!0)]))]),_:1})])])}}},Y=M(Q,[["__scopeId","data-v-2910eeb4"]]);export{Y as default};
