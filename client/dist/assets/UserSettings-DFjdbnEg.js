import{_ as $,o as q,a as C,c as J,b as s,d as l,w as r,e as O,h as D,f as U,t as f,i as g,E as w,j as i,r as m,m as M,u as T}from"./index-B2nFemfM.js";const j={class:"user-settings"},z={class:"container"},G={style:{display:"flex",gap:"12px","align-items":"flex-start"}},H={class:"level-info"},K={class:"level-display"},Q={class:"level-badge-large"},W={class:"level-details"},X={__name:"UserSettings",setup(Y){const F=T(),P=m("profile"),_=m(!1),b=m(!1),y=m(null),p=M(()=>{const a=localStorage.getItem("user");return a?JSON.parse(a):null}),u=m({account:"",username:"",avatar:"",bio:""}),d=m({oldPassword:"",newPassword:"",confirmPassword:""}),c=m({level:1,experience:0,dailyExperience:0,badge:"ğŸŒ±",nextLevelExp:10,progress:0}),E={oldPassword:[{required:!0,message:"è¯·è¾“å…¥æ—§å¯†ç ",trigger:"blur"}],newPassword:[{required:!0,message:"è¯·è¾“å…¥æ–°å¯†ç ",trigger:"blur"},{min:6,message:"å¯†ç é•¿åº¦è‡³å°‘6ä¸ªå­—ç¬¦",trigger:"blur"}],confirmPassword:[{required:!0,message:"è¯·ç¡®è®¤æ–°å¯†ç ",trigger:"blur"},{validator:(a,e,o)=>{e!==d.value.newPassword?o(new Error("ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´")):o()},trigger:"blur"}]},S=async()=>{if(!p.value){F.push("/login");return}try{const a=await g.get(`/users/${p.value.userId}`);u.value={account:a.account||p.value.account||"",username:a.username||"",avatar:a.avatar||"",bio:a.bio||""}}catch{w.error("åŠ è½½ç”¨æˆ·ä¿¡æ¯å¤±è´¥")}},I=async()=>{if(p.value)try{const a=await g.get(`/users/${p.value.userId}/level-info`);c.value=a}catch(a){console.error("åŠ è½½ç­‰çº§ä¿¡æ¯å¤±è´¥:",a)}},k=async()=>{var a,e;if(p.value){_.value=!0;try{const o=await g.put(`/users/${p.value.userId}/profile`,u.value),n=localStorage.getItem("user");if(n){const v=JSON.parse(n);v.username=o.username,v.avatar=o.avatar,v.account=o.account,localStorage.setItem("user",JSON.stringify(v))}w.success("ä¿®æ”¹æˆåŠŸ")}catch(o){w.error(((e=(a=o.response)==null?void 0:a.data)==null?void 0:e.message)||"ä¿®æ”¹å¤±è´¥")}finally{_.value=!1}}},N=async()=>{y.value&&await y.value.validate(async a=>{var e,o;if(a){b.value=!0;try{await g.put(`/users/${p.value.userId}/password`,{oldPassword:d.value.oldPassword,newPassword:d.value.newPassword}),w.success("å¯†ç ä¿®æ”¹æˆåŠŸ"),d.value={oldPassword:"",newPassword:"",confirmPassword:""}}catch(n){w.error(((o=(e=n.response)==null?void 0:e.data)==null?void 0:o.message)||"å¯†ç ä¿®æ”¹å¤±è´¥")}finally{b.value=!1}}})},R=a=>["#67C23A","#E6A23C","#F56C6C","#409EFF","#909399","#67C23A","#E6A23C","#F56C6C","#409EFF","#FFD700"][a-1]||"#409EFF";return q(()=>{S(),I()}),(a,e)=>{const o=i("el-input"),n=i("el-form-item"),v=i("el-image"),V=i("el-button"),h=i("el-form"),x=i("el-tab-pane"),L=i("el-progress"),A=i("el-tabs"),B=i("el-card");return C(),J("div",j,[s("div",z,[l(B,null,{header:r(()=>[...e[8]||(e[8]=[s("h2",null,"ä¸ªäººè®¾ç½®",-1)])]),default:r(()=>[l(A,{modelValue:P.value,"onUpdate:modelValue":e[7]||(e[7]=t=>P.value=t)},{default:r(()=>[l(x,{label:"åŸºæœ¬ä¿¡æ¯",name:"profile"},{default:r(()=>[l(h,{model:u.value,"label-width":"100px",style:{"max-width":"600px"}},{default:r(()=>[l(n,{label:"è´¦å·"},{default:r(()=>[l(o,{modelValue:u.value.account,"onUpdate:modelValue":e[0]||(e[0]=t=>u.value.account=t),disabled:"",placeholder:"è´¦å·ä¸å¯ä¿®æ”¹"},null,8,["modelValue"]),e[9]||(e[9]=s("div",{style:{"font-size":"12px",color:"#999","margin-top":"4px"}},"è´¦å·ç”¨äºç™»å½•ï¼Œæ³¨å†Œåä¸å¯ä¿®æ”¹",-1))]),_:1}),l(n,{label:"æ˜µç§°"},{default:r(()=>[l(o,{modelValue:u.value.username,"onUpdate:modelValue":e[1]||(e[1]=t=>u.value.username=t),placeholder:"è¯·è¾“å…¥æ˜µç§°"},null,8,["modelValue"])]),_:1}),l(n,{label:"å¤´åƒURL"},{default:r(()=>[s("div",G,[l(o,{modelValue:u.value.avatar,"onUpdate:modelValue":e[2]||(e[2]=t=>u.value.avatar=t),placeholder:"è¾“å…¥å¤´åƒå›¾ç‰‡URL"},null,8,["modelValue"]),u.value.avatar?(C(),O(v,{key:0,src:u.value.avatar,style:{width:"80px",height:"80px","border-radius":"50%"},fit:"cover"},null,8,["src"])):D("",!0)])]),_:1}),l(n,{label:"ä¸ªäººç®€ä»‹"},{default:r(()=>[l(o,{modelValue:u.value.bio,"onUpdate:modelValue":e[3]||(e[3]=t=>u.value.bio=t),type:"textarea",rows:3,placeholder:"ä»‹ç»ä¸€ä¸‹è‡ªå·±å§..."},null,8,["modelValue"])]),_:1}),l(n,null,{default:r(()=>[l(V,{type:"primary",onClick:k,loading:_.value},{default:r(()=>[...e[10]||(e[10]=[U(" ä¿å­˜ä¿®æ”¹ ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),l(x,{label:"ä¿®æ”¹å¯†ç ",name:"password"},{default:r(()=>[l(h,{model:d.value,rules:E,ref_key:"passwordFormRef",ref:y,"label-width":"100px",style:{"max-width":"600px"}},{default:r(()=>[l(n,{label:"æ—§å¯†ç ",prop:"oldPassword"},{default:r(()=>[l(o,{modelValue:d.value.oldPassword,"onUpdate:modelValue":e[4]||(e[4]=t=>d.value.oldPassword=t),type:"password",placeholder:"è¯·è¾“å…¥å½“å‰å¯†ç ","show-password":""},null,8,["modelValue"])]),_:1}),l(n,{label:"æ–°å¯†ç ",prop:"newPassword"},{default:r(()=>[l(o,{modelValue:d.value.newPassword,"onUpdate:modelValue":e[5]||(e[5]=t=>d.value.newPassword=t),type:"password",placeholder:"è¯·è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘6ä¸ªå­—ç¬¦ï¼‰","show-password":""},null,8,["modelValue"])]),_:1}),l(n,{label:"ç¡®è®¤å¯†ç ",prop:"confirmPassword"},{default:r(()=>[l(o,{modelValue:d.value.confirmPassword,"onUpdate:modelValue":e[6]||(e[6]=t=>d.value.confirmPassword=t),type:"password",placeholder:"è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç ","show-password":""},null,8,["modelValue"])]),_:1}),l(n,null,{default:r(()=>[l(V,{type:"primary",onClick:N,loading:b.value},{default:r(()=>[...e[11]||(e[11]=[U(" ä¿®æ”¹å¯†ç  ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),l(x,{label:"ç­‰çº§ä¿¡æ¯",name:"level"},{default:r(()=>[s("div",H,[s("div",K,[s("div",Q,f(c.value.badge),1),s("div",W,[s("h3",null,"ç­‰çº§ "+f(c.value.level),1),s("p",null,"ç»éªŒå€¼ï¼š"+f(c.value.experience)+" / "+f(c.value.nextLevelExp),1),s("p",null,"ä»Šæ—¥å·²è·å¾—ï¼š"+f(c.value.dailyExperience)+" / 100",1),l(L,{percentage:c.value.progress,color:R(c.value.level),"stroke-width":20,style:{"margin-top":"16px"}},null,8,["percentage","color"])])]),e[12]||(e[12]=s("div",{class:"experience-rules"},[s("h4",null,"ç»éªŒå€¼è·å–è§„åˆ™"),s("ul",null,[s("li",null,"å‘å¸ƒæ–‡ç« ï¼š+10 ç»éªŒ"),s("li",null,"å‘è¡¨è¯„è®ºï¼š+3 ç»éªŒ"),s("li",null,"ç‚¹èµæ–‡ç« ï¼š+2 ç»éªŒ"),s("li",null,"æ”¶è—æ–‡ç« ï¼š+2 ç»éªŒ"),s("li",null,"æ¯æ—¥ç»éªŒä¸Šé™ï¼š100 ç‚¹")])],-1))])]),_:1})]),_:1},8,["modelValue"])]),_:1})])])}}},ee=$(X,[["__scopeId","data-v-e9f3464c"]]);export{ee as default};
