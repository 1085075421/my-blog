import{_ as E,o as U,a as x,c as V,b as D,d as t,w as r,n as $,B as R,C as S,g as T,e as j,f as p,t as f,i as v,E as i,j as s,r as d,k as K,l as P}from"./index-B2nFemfM.js";const L={class:"user-management"},q={class:"header"},F={__name:"UserManagement",setup(G){const y=d([]),_=d(!1),m=d(""),g=d(1),w=d(10),h=d(0),c=async()=>{var l,e,u;_.value=!0;try{const n=await v.get("/admin/users",{params:{page:g.value-1,size:w.value,keyword:m.value||void 0}});y.value=n.content,h.value=n.totalElements}catch(n){console.error("加载用户列表失败:",n);const o=((e=(l=n.response)==null?void 0:l.data)==null?void 0:e.error)||n.message||"加载用户列表失败";i.error(o),((u=n.response)==null?void 0:u.status)===403&&i.error("您没有权限访问此功能，请确认您已登录管理员账号")}finally{_.value=!1}},M=async l=>{try{const e=l.role==="ADMIN"?"USER":"ADMIN";await v.put(`/admin/users/${l.id}/role`,{role:e}),i.success("操作成功"),c()}catch{i.error("操作失败")}},C=async l=>{try{await P.confirm(`确定要删除用户 "${l.username}" 吗？此操作不可恢复！`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await v.delete(`/admin/users/${l.id}`),i.success("删除成功"),c()}catch(e){e!=="cancel"&&i.error("删除失败")}},k=l=>l?new Date(l).toLocaleString("zh-CN"):"";return U(()=>{c()}),(l,e)=>{const u=s("el-icon"),n=s("el-input"),o=s("el-table-column"),N=s("el-tag"),b=s("el-button"),A=s("el-table"),B=s("el-pagination"),I=K("loading");return x(),V("div",L,[D("div",q,[e[2]||(e[2]=D("h2",null,"用户管理",-1)),t(n,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=a=>m.value=a),placeholder:"搜索用户（账号/昵称/邮箱）",style:{width:"300px"},clearable:"",onClear:c,onKeyup:S(c,["enter"])},{prefix:r(()=>[t(u,null,{default:r(()=>[t($(R))]),_:1})]),_:1},8,["modelValue"])]),T((x(),j(A,{data:y.value,style:{width:"100%"}},{default:r(()=>[t(o,{prop:"id",label:"ID",width:"80"}),t(o,{prop:"account",label:"账号",width:"120"}),t(o,{prop:"username",label:"昵称",width:"120"}),t(o,{prop:"email",label:"邮箱",width:"200"}),t(o,{prop:"role",label:"角色",width:"100"},{default:r(({row:a})=>[t(N,{type:a.role==="ADMIN"?"danger":"info"},{default:r(()=>[p(f(a.role==="ADMIN"?"管理员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),t(o,{prop:"level",label:"等级",width:"80"}),t(o,{prop:"experience",label:"经验值",width:"100"}),t(o,{prop:"createdAt",label:"注册时间",width:"180"},{default:r(({row:a})=>[p(f(k(a.createdAt)),1)]),_:1}),t(o,{label:"操作",width:"200",fixed:"right"},{default:r(({row:a})=>[t(b,{size:"small",type:a.role==="ADMIN"?"default":"warning",onClick:z=>M(a)},{default:r(()=>[p(f(a.role==="ADMIN"?"取消管理员":"设为管理员"),1)]),_:2},1032,["type","onClick"]),t(b,{size:"small",type:"danger",onClick:z=>C(a)},{default:r(()=>[...e[3]||(e[3]=[p(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[I,_.value]]),t(B,{"current-page":g.value,"onUpdate:currentPage":e[1]||(e[1]=a=>g.value=a),"page-size":w.value,total:h.value,layout:"total, prev, pager, next",onCurrentChange:c,style:{"margin-top":"20px","justify-content":"center"}},null,8,["current-page","page-size","total"])])}}},J=E(F,[["__scopeId","data-v-35d39ac9"]]);export{J as default};
